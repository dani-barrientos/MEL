<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MEL: Work flows</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MEL
   </div>
   <div id="projectbrief">Microthread &amp; Execution library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('execution_flows.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Work flows </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#conditions">Conditions</a></li>
<li><a href="#launching_flows">Launching flows</a></li>
<li><a href="#loops">Loops</a></li>
<li><a href="#flow_chart">Flow chart example</a></li>
</ul>
<h3><a class="anchor" id="introduction"></a>
Introduction</h3>
<p>It's possible to create independent work flows to reuse then or apply them at functions as condition. A <em>flow</em> could be defined as a callable with signature <code>ExFuture&lt;...&gt; flow( ExFuture&lt;...&gt; )</code>, meaning that it can substitute a chain of job. With the help of <em>generic lambdas</em> this callable will be defined as <code>[](auto input)-&gt;auto</code>.</p>
<p>The lambda or callable used as a flow will receive an <a class="el" href="classmel_1_1execution_1_1_ex_future.html">ExFuture</a> which serves as the input of any other <em>execution</em> function. Let's start with a simple example, defining two flows: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ExecutorType&gt; <span class="keywordtype">void</span> _sampleFlows1(ExecutorType ex)</div>
<div class="line">{   </div>
<div class="line">    <span class="keyword">auto</span> th = ThreadRunnable::create();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//create a flow. input parameter is an ExFuture depending on given executor</span></div>
<div class="line">    <span class="keyword">auto</span> flow1 = [](<span class="keyword">auto</span> input)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> input | execution::next(</div>
<div class="line">            [](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> str+<span class="stringliteral">&quot; Dani&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        );</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    th-&gt;fireAndForget([ex,flow1] () <span class="keyword">mutable</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> res = mel::tasking::waitForFutureMThread&lt;::mel::core::WaitErrorNoException&gt;(</div>
<div class="line">                execution::launch(ex,[]()</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Hello&quot;</span>s;</div>
<div class="line">                }</div>
<div class="line">            )</div>
<div class="line">            | flow1</div>
<div class="line">            | execution::next([](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span>  str + <span class="stringliteral">&quot; Barrientos&quot;</span>;</div>
<div class="line">                }</div>
<div class="line">            )</div>
<div class="line">            | </div>
<div class="line">            [](<span class="keyword">auto</span> input)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> input | execution::next([](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">return</span> str + <span class="stringliteral">&quot;. Bye!!&quot;</span>;</div>
<div class="line">                    }</div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">        );</div>
<div class="line">        <span class="keywordflow">if</span> ( res.isValid())</div>
<div class="line">        {</div>
<div class="line">            text::info(<span class="stringliteral">&quot;Result = {}&quot;</span>,res.value());</div>
<div class="line">        }<span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                std::rethrow_exception(res.error());                </div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(...)</div>
<div class="line">            {</div>
<div class="line">                ::text::error(<span class="stringliteral">&quot;Some error occured!!&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    },0,::tasking::Runnable::killFalse);</div>
<div class="line">}</div>
</div><!-- fragment --><p> Output will be: </p><pre class="fragment">Result = Hello Dani Barrientos. Bye!!
</pre> <h3><a class="anchor" id="conditions"></a>
Conditions</h3>
<p>Besides creating flows for reusability, one important use is for conditions, which are the equivalent to a normal <em>switch</em>, such that a flow is selected based on the previous result in the chain. In the next example a flow is chosen, between two, according to a random number. Both flows are written as lambas local to the function, but any other callbable could be used or lambdas written inline in the code, it's shown this way for clarity.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ExecutorType&gt; <span class="keywordtype">void</span> _sampleFlowsCondition(ExecutorType ex)</div>
<div class="line">{   </div>
<div class="line">    <span class="keyword">auto</span> th = ThreadRunnable::create();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//create a flow. input paramter is an ExFuture depending on given executor</span></div>
<div class="line">    <span class="keyword">auto</span> flow0 = [](<span class="comment">/*execution::ExFuture&lt;ExecutorType,string&gt; */</span><span class="keyword">auto</span> input)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> input | execution::next(</div>
<div class="line">            [](<span class="keywordtype">int</span> val)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Flow0&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        );</div>
<div class="line">    };</div>
<div class="line">    <span class="keyword">auto</span> flow1 = [](<span class="keyword">auto</span> input)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> input | execution::next(</div>
<div class="line">            [](<span class="keywordtype">int</span> val)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Flow1&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        );</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    th-&gt;fireAndForget([ex,flow0,flow1] () <span class="keyword">mutable</span></div>
<div class="line">    {</div>
<div class="line">        srand(time(NULL));</div>
<div class="line">        <span class="keyword">auto</span> res = mel::tasking::waitForFutureMThread&lt;::mel::core::WaitErrorNoException&gt;(</div>
<div class="line">                execution::launch(ex,[]()</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span> rand()%10;</div>
<div class="line">                }</div>
<div class="line">            )</div>
<div class="line">            | execution::condition(</div>
<div class="line">                [](<span class="keywordtype">int</span> val)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">int</span> result = val&lt;5?0:1;</div>
<div class="line">                    text::info(<span class="stringliteral">&quot;Input value = {}. Selecting flow {}&quot;</span>,val,result);</div>
<div class="line">                    <span class="keywordflow">return</span> result;</div>
<div class="line">                },</div>
<div class="line">                flow0,flow1</div>
<div class="line">            )</div>
<div class="line">            | execution::next( [](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> str+<span class="stringliteral">&quot; End!&quot;</span>;</div>
<div class="line">            })</div>
<div class="line">            </div>
<div class="line">        );</div>
<div class="line">        <span class="keywordflow">if</span> ( res.isValid())</div>
<div class="line">        {</div>
<div class="line">            text::info(<span class="stringliteral">&quot;Result = {}&quot;</span>,res.value());</div>
<div class="line">        }<span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                std::rethrow_exception(res.error());                </div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(...)</div>
<div class="line">            {</div>
<div class="line">                ::text::error(<span class="stringliteral">&quot;Some error occured!!&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    },0,::tasking::Runnable::killFalse);</div>
<div class="line">}</div>
</div><!-- fragment --><p> And the output, in a concrete execution, is: </p><pre class="fragment">Input value = 3. Selecting flow 0
Result = Flow0 End!
</pre><h3><a class="anchor" id="launching_flows"></a>
Launching flows</h3>
<p>Flows can also be <em>launched at same time</em> (of course, this concept of <em>same time</em> depends on the underlying executor capabilities) via <a class="el" href="namespacemel_1_1execution_1_1flow.html#a4a19431bbce0e08e7adf119f264d7df9">flow::launch</a> and get a <em>tuple of ExFuture</em> as a result, being each position in the tuple the result of the corresponding flow. Below an example of launching three flows, one of which can throw exception randomly. The function <a class="el" href="namespacemel_1_1execution_1_1flow.html#a7a8a2083987256cfb2c4f38e8ac7662e">flow::on_all</a> is used to get the result of all flows as a tuple. As can be seen, throwing error in any flow is propagated correctly to the final result. </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ExecutorType&gt; <span class="keywordtype">void</span> _sampleFlowLaunch(ExecutorType ex)</div>
<div class="line">{   </div>
<div class="line">    <span class="keyword">auto</span> th = ThreadRunnable::create();</div>
<div class="line"> </div>
<div class="line">    th-&gt;fireAndForget([ex] () <span class="keyword">mutable</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">try</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">auto</span> finalRes =  mel::tasking::waitForFutureMThread&lt;::mel::core::WaitErrorAsException&gt;(</div>
<div class="line">                execution::launch(ex,[]() noexcept{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Starting job!!&quot;</span>s;})</div>
<div class="line">                | execution::parallel_convert(</div>
<div class="line">                    [](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str)  noexcept</div>
<div class="line">                    {</div>
<div class="line">                        mel::text::info(<span class="stringliteral">&quot;parallel_convert task 1, returning void&quot;</span>);</div>
<div class="line">                    },</div>
<div class="line">                    [](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; str) noexcept</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">return</span> str+<span class="stringliteral">&quot; Second parallel task&quot;</span>s;</div>
<div class="line">                    }</div>
<div class="line">                ) </div>
<div class="line">                | execution::flow::launch( </div>
<div class="line">                    [](<span class="keyword">auto</span> input) noexcept</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">return</span> input | execution::inmediate(<span class="stringliteral">&quot;hola&quot;</span>s)</div>
<div class="line">                        | execution::next( [](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s)</div>
<div class="line">                            {</div>
<div class="line">                                <span class="keywordflow">if</span> ( rand()%10 &lt; 5 )</div>
<div class="line">                                    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;parallel:_convert second task. Throwing exception!!&quot;</span>);</div>
<div class="line">                            }</div>
<div class="line">                        ); <span class="comment">//return void for testing purposes</span></div>
<div class="line">                    },</div>
<div class="line">                    [](<span class="keyword">auto</span> input) noexcept</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">return</span> input | execution::inmediate(7.8f);</div>
<div class="line">                    }</div>
<div class="line">                    ,</div>
<div class="line">                    [](<span class="keyword">auto</span> input) noexcept</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">return</span> input | execution::next( [](<span class="keyword">const</span> std::tuple&lt;mel::execution::VoidType,string&gt;&amp; v) noexcept</div>
<div class="line">                            {</div>
<div class="line">                                <span class="keywordflow">return</span> std::get&lt;1&gt;(v).size();</div>
<div class="line">                            }</div>
<div class="line">                         );</div>
<div class="line">                    }</div>
<div class="line">                )</div>
<div class="line">                | <a class="code" href="namespacemel_1_1execution_1_1flow.html#a7a8a2083987256cfb2c4f38e8ac7662e">mel::execution::flow::on_all</a>(ex)</div>
<div class="line">            );                          </div>
<div class="line">            <span class="keyword">auto</span>&amp; finalValue = finalRes.value();</div>
<div class="line">            mel::text::info(<span class="stringliteral">&quot;Final res = (void,{},{})&quot;</span>,std::get&lt;1&gt;(finalValue),std::get&lt;2&gt;(finalValue));</div>
<div class="line">        }<span class="keywordflow">catch</span>( <a class="code" href="classmel_1_1execution_1_1_on_all_exception.html">mel::execution::OnAllException</a>&amp; e)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                rethrow_exception( e.getCause() );</div>
<div class="line">            }<span class="keywordflow">catch</span>(std::exception&amp; e)</div>
<div class="line">            {</div>
<div class="line">                mel::text::error(<span class="stringliteral">&quot;Error {}&quot;</span>,e.what());</div>
<div class="line">            }<span class="keywordflow">catch</span>(...)</div>
<div class="line">            {</div>
<div class="line">                mel::text::error(<span class="stringliteral">&quot;OnAllException. unknown error&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">catch</span>(std::exception&amp; e)</div>
<div class="line">        {</div>
<div class="line">            mel::text::error(e.what());</div>
<div class="line">        }<span class="keywordflow">catch</span>(...)</div>
<div class="line">        {</div>
<div class="line">            mel::text::error(<span class="stringliteral">&quot;Unknown error!!!&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    },0,::tasking::Runnable::killFalse);</div>
<div class="line">}</div>
<div class="ttc" id="aclassmel_1_1execution_1_1_on_all_exception_html"><div class="ttname"><a href="classmel_1_1execution_1_1_on_all_exception.html">mel::execution::OnAllException</a></div><div class="ttdoc">Excepcion thrown by on_all when some of the futures raise error.</div><div class="ttdef"><b>Definition:</b> Executor.h:809</div></div>
<div class="ttc" id="anamespacemel_1_1execution_1_1flow_html_a7a8a2083987256cfb2c4f38e8ac7662e"><div class="ttname"><a href="namespacemel_1_1execution_1_1flow.html#a7a8a2083987256cfb2c4f38e8ac7662e">mel::execution::flow::on_all</a></div><div class="ttdeci">auto on_all(Executor&lt; ExecutionAgent &gt; ex, TupleFlow &amp;&amp;f)</div><div class="ttdoc">Takes a tuple with the results of execution of some flows and does a execution::on_all.</div><div class="ttdef"><b>Definition:</b> Launch.h:76</div></div>
</div><!-- fragment --> <h3><a class="anchor" id="loops"></a>
Loops</h3>
<p>It's possible to implement iterations as part of an execution flow. There are two kinds of iterations in flows: <em>sequential</em>, implemented with <a class="el" href="namespacemel_1_1execution_1_1flow.html#a621cba67bd9f449d2e5f42b8d4db59a0">flow::doWhile</a> and <em>independent iterations</em> with <a class="el" href="namespacemel_1_1execution_1_1flow.html#aa1fc5a2ec463d8f3f4b0436543d4dbb0">flow::loop</a>.</p>
<p>Below an example of using <a class="el" href="namespacemel_1_1execution_1_1flow.html#a621cba67bd9f449d2e5f42b8d4db59a0">doWhile</a> where a random number is created and shown in console for 4 times, doing a <em>microthread wait</em> in each iteration (if used executor allows it) </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ExecutorType&gt; <span class="keywordtype">void</span> _sampleWhile(ExecutorType ex)</div>
<div class="line">{   </div>
<div class="line">    <span class="keyword">auto</span> th = ThreadRunnable::create();</div>
<div class="line"> </div>
<div class="line">    th-&gt;fireAndForget([ex] () <span class="keyword">mutable</span></div>
<div class="line">    {</div>
<div class="line">        srand(time(NULL));</div>
<div class="line">        <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">        <span class="keyword">auto</span> res = mel::tasking::waitForFutureMThread&lt;::mel::core::WaitErrorNoException&gt;(</div>
<div class="line">                execution::start(ex)</div>
<div class="line">                | execution::doWhile( </div>
<div class="line">                    []( <span class="keyword">auto</span> input ) noexcept</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">return</span> input | execution::next( []() noexcept -&gt; <span class="keywordtype">int</span></div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">return</span> rand()%10;</div>
<div class="line">                        })</div>
<div class="line">                        | execution::next( [](<span class="keywordtype">int</span> v ) noexcept</div>
<div class="line">                        {</div>
<div class="line">                            mel::text::info(<span class="stringliteral">&quot; new value = {}&quot;</span>,v);</div>
<div class="line">                            <span class="keywordflow">if</span> constexpr(execution::ExecutorTraits&lt;decltype(ex)&gt;::has_microthreading)</div>
<div class="line">                            {</div>
<div class="line">                                <a class="code" href="classmel_1_1tasking_1_1_process.html#ae3350d1645cca8cb94f65b1b85dff032">mel::tasking::Process::wait</a>(2500);</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">else</span></div>
<div class="line">                                mel::text::info(<span class="stringliteral">&quot;Current executor doesn&#39;t supports true parallelism, wait not done&quot;</span>);</div>
<div class="line">                        });</div>
<div class="line">                    },</div>
<div class="line">                    [idx]() <span class="keyword">mutable</span> noexcept</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">if</span> ( ++idx == 4 )</div>
<div class="line">                            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//finish while</span></div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                            <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//continue iterating</span></div>
<div class="line">                    }</div>
<div class="line">                </div>
<div class="line">            )                       </div>
<div class="line">        );</div>
<div class="line">        <span class="keywordflow">if</span> ( res.isValid())</div>
<div class="line">        {</div>
<div class="line">            text::info(<span class="stringliteral">&quot;Finished&quot;</span>);</div>
<div class="line">        }<span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                std::rethrow_exception(res.error());                </div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(...)</div>
<div class="line">            {</div>
<div class="line">                ::text::error(<span class="stringliteral">&quot;Some error occured!!&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    },0,::tasking::Runnable::killFalse);</div>
<div class="line">}</div>
<div class="ttc" id="aclassmel_1_1tasking_1_1_process_html_ae3350d1645cca8cb94f65b1b85dff032"><div class="ttname"><a href="classmel_1_1tasking_1_1_process.html#ae3350d1645cca8cb94f65b1b85dff032">mel::tasking::Process::wait</a></div><div class="ttdeci">static ESwitchResult wait(unsigned int msegs) OPTIMIZE_FLAGS</div></div>
</div><!-- fragment --><p>And now an example of <a class="el" href="namespacemel_1_1execution_1_1flow.html#aa1fc5a2ec463d8f3f4b0436543d4dbb0">flow::loop</a> where iterations are independent, and so could be parallelized if executor allows it. </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ExecutorType&gt; <span class="keywordtype">void</span> _sampleFlowLoop(ExecutorType ex)</div>
<div class="line">{   </div>
<div class="line">    <span class="keyword">auto</span> th = ThreadRunnable::create();</div>
<div class="line">    th-&gt;fireAndForget([ex] () <span class="keyword">mutable</span></div>
<div class="line">    {</div>
<div class="line">        srand(time(NULL));</div>
<div class="line">        <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">        <span class="keyword">auto</span> res = mel::tasking::waitForFutureMThread&lt;::mel::core::WaitErrorNoException&gt;(</div>
<div class="line">                execution::start(ex)</div>
<div class="line">                | execution::flow::loop( 0,4,</div>
<div class="line">                    []( <span class="keywordtype">int</span> idx, <span class="keyword">auto</span> input ) noexcept</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">return</span> input | execution::next( []() noexcept -&gt; <span class="keywordtype">int</span></div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">return</span> rand()%10;</div>
<div class="line">                        })</div>
<div class="line">                        | execution::next( [](<span class="keywordtype">int</span> v ) noexcept</div>
<div class="line">                        {</div>
<div class="line">                            mel::text::info(<span class="stringliteral">&quot; new value = {}. Now waiting&quot;</span>,v);</div>
<div class="line">                            <span class="keywordflow">if</span> constexpr(execution::ExecutorTraits&lt;decltype(ex)&gt;::has_microthreading)</div>
<div class="line">                            {</div>
<div class="line">                                <a class="code" href="classmel_1_1tasking_1_1_process.html#ae3350d1645cca8cb94f65b1b85dff032">mel::tasking::Process::wait</a>(2500);</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">else</span></div>
<div class="line">                                mel::text::info(<span class="stringliteral">&quot;Current executor doesn&#39;t support true parallelism, wait not done&quot;</span>);</div>
<div class="line">                            mel::text::info(<span class="stringliteral">&quot; new value = {}. After wait&quot;</span>,v);</div>
<div class="line">                        });</div>
<div class="line">                    }               </div>
<div class="line">                )</div>
<div class="line">                | execution::next( []{</div>
<div class="line">                    mel::text::info(<span class="stringliteral">&quot; Flow finished!!&quot;</span>);</div>
<div class="line">                })</div>
<div class="line">        );</div>
<div class="line">        <span class="keywordflow">if</span> ( res.isValid())</div>
<div class="line">        {</div>
<div class="line">            text::info(<span class="stringliteral">&quot;Finished&quot;</span>);</div>
<div class="line">        }<span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                std::rethrow_exception(res.error());                </div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span>(...)</div>
<div class="line">            {</div>
<div class="line">                ::text::error(<span class="stringliteral">&quot;Some error occured!!&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    },0,::tasking::Runnable::killFalse);</div>
<div class="line">}</div>
</div><!-- fragment --><p> The fact that independent iterations are used can be seen in the output ,where an iteration doesn't need the previous to be finished: </p><pre class="fragment">new value = 9. Now waiting
new value = 1. Now waiting
new value = 3. Now waiting
new value = 3. Now waiting
new value = 9. After wait
new value = 3. After wait
new value = 1. After wait
new value = 3. After wait
</pre><h3><a class="anchor" id="flow_chart"></a>
Flow chart example</h3>
<p>TODO PONER UN EJEMPLO PITNANDO UN DIAGRAMA DE FLUJO EN IMPLEMENTARLO </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Introduction</a></li><li class="navelem"><a class="el" href="execution_system.html">Execution System</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
